<!DOCTYPE html>
<html data-bs-theme="light" lang="es-419">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Portería - Control Acceso</title>
    <link rel="stylesheet" href="../assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="../assets/fonts/fontawesome-all.min.css">
    <link rel="stylesheet" href="../assets/css/bs-theme-overrides.css">
    <style>
        .action-card {
            border: none;
            border-radius: 15px;
            transition: transform 0.2s;
        }

        .action-card:active {
            transform: scale(0.98);
        }

        .vehicle-card {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 5px solid #1cc88a;
            /* Default En Planta */
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        .status-badge {
            font-size: 0.8em;
            padding: 5px 10px;
            border-radius: 20px;
        }
    </style>
</head>

<body id="page-top">
    <script src="../assets/js/auth_guard.js"></script>
    <div id="wrapper">
        <div id="sidebar"></div>
        <div class="d-flex flex-column" id="content-wrapper">
            <div id="content">
                <div id="navbar"></div>

                <div class="container-fluid">
                    <h3 class="text-dark mb-4">Control de Acceso</h3>

                    <div class="row g-3 mb-4">
                        <!-- Ingreso Card -->
                        <div class="col-md-6">
                            <div class="card shadow action-card h-100">
                                <div class="card-header bg-success text-white py-3">
                                    <h5 class="m-0 fw-bold"><i class="fas fa-sign-in-alt me-2"></i>Registrar Ingreso
                                    </h5>
                                </div>
                                <div class="card-body">
                                    <div class="input-group mb-3">
                                        <input type="text" id="ingreso-placa" class="form-control form-control-lg"
                                            placeholder="Placa (ej. ABC-123)" style="text-transform: uppercase;">
                                        <button class="btn btn-success" onclick="verificarPlacaIngreso()">
                                            <i class="fas fa-search"></i>
                                        </button>
                                    </div>
                                    <div id="ingreso-info" class="d-none animate__animated animate__fadeIn">
                                        <div class="alert alert-light border shadow-sm" id="ingreso-status"></div>
                                        <button class="btn btn-success w-100 btn-lg shadow" id="btn-registrar-ingreso"
                                            onclick="registrarIngreso()" disabled>
                                            Confirmar Ingreso
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Salida Card -->
                        <div class="col-md-6">
                            <div class="card shadow action-card h-100">
                                <div class="card-header bg-primary text-white py-3">
                                    <h5 class="m-0 fw-bold"><i class="fas fa-sign-out-alt me-2"></i>Registrar Salida
                                    </h5>
                                </div>
                                <div class="card-body">
                                    <div class="input-group mb-3">
                                        <input type="text" id="salida-placa" class="form-control form-control-lg"
                                            placeholder="Placa (ej. ABC-123)" style="text-transform: uppercase;">
                                        <button class="btn btn-primary" onclick="verificarPlacaSalida()">
                                            <i class="fas fa-search"></i>
                                        </button>
                                    </div>
                                    <div id="salida-info" class="d-none animate__animated animate__fadeIn">
                                        <div class="alert alert-light border shadow-sm" id="salida-status"></div>
                                        <button class="btn btn-primary w-100 btn-lg shadow" id="btn-registrar-salida"
                                            onclick="registrarSalida()" disabled>
                                            Confirmar Salida
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <h5 class="text-gray-800 mb-3">Vehículos en Planta</h5>

                    <!-- Mobile List View -->
                    <div id="list-en-planta" class="d-md-none">
                        <!-- JS populated -->
                    </div>

                    <!-- Desktop Table View -->
                    <div class="card shadow d-none d-md-block">
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-bordered" id="tabla-en-planta" width="100%">
                                    <thead class="bg-light">
                                        <tr>
                                            <th>Placa</th>
                                            <th>Tipo</th>
                                            <th>Empresa</th>
                                            <th>Ingreso</th>
                                            <th>Estado</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- JS populated -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

            <footer class="bg-white sticky-footer">
                <div class="container my-auto">
                    <div class="text-center my-auto copyright"><span>© OSM 2025</span></div>
                </div>
            </footer>
        </div>
    </div>

    <script src="../assets/bootstrap/js/bootstrap.min.js"></script>
    <script src="../assets/js/sidebar.js"></script>
    <script src="../assets/js/navbar.js"></script>
    <script src="../assets/js/bs-init.js"></script>
    <script src="../assets/js/component_loader.js"></script>
    <script src="../assets/js/web_config.js"></script>
    <script src="assets/js/control_acceso.js"></script>
    <script>
        // Override loadVehiculosEnPlanta for mobile view
        const originalLoad = loadVehiculosEnPlanta;
        loadVehiculosEnPlanta = function () {
            fetch(`${API_URL}?action=get_vehiculos`)
                .then(response => response.json())
                .then(data => {
                    const tbody = document.querySelector('#tabla-en-planta tbody');
                    tbody.innerHTML = '';

                    const list = document.getElementById('list-en-planta');
                    list.innerHTML = '';

                    data.data.forEach(v => {
                        if (v.ubicacion_actual === 'en_planta') {
                            // Table Row
                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td class="fw-bold">${v.placa}</td>
                                <td>${v.tipo_vehiculo}</td>
                                <td>${v.empresa || '-'}</td>
                                <td>${formatDate(v.updated_at)}</td>
                                <td><span class="badge bg-success rounded-pill">En Planta</span></td>
                            `;
                            tbody.appendChild(row);

                            // Mobile Card
                            const card = document.createElement('div');
                            card.className = 'vehicle-card';
                            card.innerHTML = `
                                <div class="d-flex justify-content-between align-items-center">
                                    <h5 class="fw-bold m-0">${v.placa}</h5>
                                    <span class="badge bg-success rounded-pill">En Planta</span>
                                </div>
                                <div class="text-muted small mt-1">${v.tipo_vehiculo} - ${v.empresa || 'Sin Empresa'}</div>
                                <div class="text-muted small mt-2">
                                    <i class="fas fa-clock"></i> ${formatDate(v.updated_at)}
                                </div>
                            `;
                            list.appendChild(card);
                        }
                    });
                });
        }
    </script>
</body>

</html>